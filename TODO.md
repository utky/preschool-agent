# TODO (スライスベース計画)

このタスクリストは、小さく完全な機能スライスを継続的にデプロイしていくアジャイルなアプローチに基づいています。

---

### フェーズ 0: 開発プロセスの定義

- [ ] 開発フローを `GEMINI.md` に記載する

---

### フェーズ 1: パイプラインの確立 (Health-Checkスライス)

**目標:** 最小限のアプリケーションを本番環境にデプロイし、CI/CDパイプラインを完全に確立する。

- [ ] **環境構築:**
    - [ ] devcontainer の設定整備
    - [ ] Python 3.12, `uv`, `ty`, `ruff` の導入
    - [ ] `backend`, `frontend` のディレクトリ構造を作成
- [ ] **インフラ (IaC):**
    - [ ] OpenTofuで最小限のリソースを定義 (Cloud Run, IAP, Artifact Registry, GCS for Tofu state)
- [ ] **バックエンド (FastAPI):**
    - [ ] `GET /api/health` エンドポイントを1つ作成
- [ ] **フロントエンド (React):**
    - [ ] `/api/health` を呼び出し、結果を表示するだけのシンプルなページを作成
- [ ] **CI/CD (GitHub Actions):**
    - [ ] **CI:** `tofu plan` と最小限のテストを実行するPRワークフローを構築
    - [ ] **CD:** アプリをビルド・コンテナ化し、Cloud Runへ自動デプロイするワークフローを構築

---

### フェーズ 2: PDFメタデータ登録スライス

**目標:** PDFを処理し、その記録をDBに保存・表示する、データ処理の基本フローを完成させる。

- [ ] **インフラ (IaC):**
    - [ ] リソースを追加: Cloud Storage (PDF格納用), Cloud Function, Document AI, BigQuery (`documents`テーブル)
- [ ] **バックエンド (TDD):**
    - [ ] 手動トリガーでPDFを解析し、メタデータをBigQueryに保存するCloud Functionを実装
    - [ ] 処理済みドキュメント一覧を返す `GET /api/documents` エンドポイントを実装
- [ ] **フロントエンド (TDD):**
    - [ ] `/api/documents` から取得したドキュメント一覧を表示するページを作成

---

### フェーズ 3: Google Drive連携と定期実行スライス

**目標:** Google Driveを監視し、新規ファイルを自動的に検出・処理する仕組みを構築する。

- [ ] **インフラ (IaC):**
    - [ ] Cloud Schedulerを追加し、Google Drive APIの権限を設定
- [ ] **バックエンド (TDD):**
    - [ ] Cloud Functionを拡張し、Schedulerによる定期実行に対応
    - [ ] Google Driveの特定フォルダをポーリングし、未処理の新規ファイルを検出して処理パイプラインに連携するロジックを実装

---

### フェーズ 4: RAGエージェント (チャット) スライス

**目標:** 蓄積されたデータに対する自然言語での問い合わせに応答するAIエージェントを実装する。

- [ ] **バックエンド (TDD):**
    - [ ] ADK (Agent Development Kit) をセットアップ
    - [ ] BigQueryのテーブルを横断検索する `BigQuery Retriever Tool` を実装
    - [ ] `POST /api/chat` エンドポイントとセッション管理を実装
- [ ] **フロントエンド (TDD):**
    - [ ] AIと対話するためのチャットUIコンポーネントを作成し、ダッシュボードに統合

---

### フェーズ 5: カレンダーイベント抽出・表示スライス

**目標:** PDFからカレンダー登録候補となるイベントを抽出し、ユーザーに提示する。

- [ ] **インフラ (IaC):**
    - [ ] BigQueryに `calendar_events` テーブルを追加
- [ ] **バックエンド (TDD):**
    - [ ] PDF解析ロジックを拡張し、「予定」に関する情報を抽出して `calendar_events` テーブルに保存する機能を追加
    - [ ] `GET /api/calendar/events` エンドポイントを実装
- [ ] **フロントエンド (TDD):**
    - [ ] カレンダー登録候補のイベントをリスト表示するUIを作成

---

### フェーズ 6: カレンダーイベント承認スライス

**目標:** ユーザーが承認したイベントを実際にGoogle Calendarに登録する。

- [ ] **インフラ (IaC):**
    - [ ] Google Calendar APIの権限を設定
- [ ] **バックエンド (TDD):**
    - [ ] `POST /api/calendar/events/{event_id}/approve` エンドポイントを実装
    - [ ] Google Calendar APIを呼び出してカレンダーにイベントを作成するロジックを実装
- [ ] **フロントエンド (TDD):**
    - [ ] イベントリストに「承認」ボタンを追加し、APIを呼び出す機能を実装

---

### フェーズ 7: 写真ギャラリースライス

**目標:** PDFから抽出した写真をWeb UI上で閲覧できるようにする。

- [ ] **インフラ (IaC):**
    - [ ] BigQueryに `images` テーブルを追加
- [ ] **バックエンド (TDD):**
    - [ ] PDF解析ロジックを拡張し、画像を抽出してCloud Storageに保存する機能を追加
    - [ ] 画像のメタデータを `images` テーブルに保存する機能を追加
    - [ ] 署名付きURLを返す `GET /api/photos` エンドポイントを実装
- [ ] **フロントエンド (TDD):**
    - [ ] 写真を一覧表示するギャラリーページを作成